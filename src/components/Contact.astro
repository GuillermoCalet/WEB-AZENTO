---
/**
 * Contact.astro - Sección de contacto con formulario elegante
 * Diseño minimalista con efecto glassmorphism
 */

// Datos de contacto - Fácil de editar
const sectionData = {
	tagline: "Contacto",
	headline: "Hagamos realidad tu proyecto",
	description: "Cuéntanos tu visión y te ayudaremos a transformar tu espacio. Te responderemos lo antes posible.",
};

const contactInfo = [
	{
		icon: "phone",
		label: "Teléfonos",
		value: "682 412 236 · 659 136 093",
		href: "tel:+34682412236",
	},
	{
		icon: "email",
		label: "Email",
		value: "info@azentohome.com",
		href: "mailto:info@azentohome.com",
	},
	{
		icon: "instagram",
		label: "Instagram",
		value: "@azentohome",
		href: "https://www.instagram.com/azentohome/",
	},
	{
		icon: "location",
		label: "Ubicación",
		value: "Madrid y alrededores",
		href: "#",
	},
];

// Iconos SVG
const icons: Record<string, string> = {
	phone: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"/>`,
	email: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"/>`,
	instagram: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.802.054-1.645.054H3.25a2.25 2.25 0 00-2.25 2.25v9.466a2.25 2.25 0 002.25 2.25h17.5a2.25 2.25 0 002.25-2.25V9.534a2.25 2.25 0 00-2.25-2.25h-.291c-.843 0-1.265 0-1.645-.054a2.31 2.31 0 01-1.641-1.055c-.218-.355-.343-.751-.593-1.545l-.017-.053a9.125 9.125 0 00-.338-.91 2.1 2.1 0 00-.989-1.002C15.009 2.5 14.747 2.5 14.223 2.5H9.777c-.524 0-.786 0-1.013.165a2.1 2.1 0 00-.989 1.002c-.095.214-.19.51-.338.91l-.017.053c-.25.794-.375 1.19-.593 1.545zM12 16a3 3 0 100-6 3 3 0 000 6z"/>`,
	location: `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/>`,
};
---

<section id="contacto" class="py-24 lg:py-32 bg-neutral-100 relative overflow-hidden">
	<!-- Decorative background -->
	<div class="absolute top-0 left-0 w-full h-full">
		<div class="absolute top-1/4 -left-20 w-80 h-80 bg-azento-200/30 rounded-full blur-3xl"></div>
		<div class="absolute bottom-1/4 -right-20 w-96 h-96 bg-accent-200/40 rounded-full blur-3xl"></div>
	</div>

	<div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
		<div class="grid lg:grid-cols-2 gap-12 lg:gap-20 items-center">
			<!-- Left Column - Content -->
			<div>
				<!-- Section Header -->
				<span class="inline-block text-accent-600 font-medium text-sm tracking-widest uppercase mb-4">
					{sectionData.tagline}
				</span>
				
				<h2 class="font-display text-3xl sm:text-4xl lg:text-5xl font-semibold text-azento-700 mb-6">
					{sectionData.headline}
				</h2>
				
				<p class="text-lg text-azento-500/80 leading-relaxed mb-10">
					{sectionData.description}
				</p>

				<!-- Contact Info Cards -->
				<div class="space-y-4">
					{contactInfo.map((info) => (
						<a 
							href={info.href}
							class="flex items-center gap-4 p-4 rounded-2xl bg-white/50 backdrop-blur-sm
								border border-neutral-200 hover:border-accent-300 hover:bg-white
								transition-all duration-300 group"
						>
							<div class="w-12 h-12 rounded-xl bg-azento-600 flex items-center justify-center
								group-hover:bg-azento-500 transition-colors">
								<svg 
									class="w-5 h-5 text-white" 
									fill="none" 
									stroke="currentColor" 
									viewBox="0 0 24 24"
									set:html={icons[info.icon]}
								/>
							</div>
							<div>
								<span class="block text-sm text-azento-400 mb-0.5">{info.label}</span>
								<span class="font-medium text-azento-700 group-hover:text-azento-600">
									{info.value}
								</span>
							</div>
						</a>
					))}
				</div>
			</div>

			<!-- Right Column - Form -->
			<div class="bg-white/80 backdrop-blur-xl rounded-3xl p-8 lg:p-10 shadow-xl shadow-azento-900/5 border border-neutral-200">
				<h3 class="font-display text-2xl font-semibold text-azento-700 mb-6">
					Solicita tu presupuesto
				</h3>

				<form id="quote-form" class="space-y-5">
					<!-- Honeypot field (anti-spam) - oculto para usuarios -->
					<div class="hidden" aria-hidden="true">
						<label for="website">Website</label>
						<input 
							type="text" 
							id="website" 
							name="website"
							tabindex="-1"
							autocomplete="off"
						/>
					</div>

					<!-- Name Field -->
					<div>
						<label for="name" class="block text-sm font-medium text-azento-600 mb-2">
							Nombre completo <span class="text-red-500">*</span>
						</label>
						<input 
							type="text" 
							id="name" 
							name="name"
							placeholder="Tu nombre"
							maxlength="100"
							class="w-full px-4 py-3 rounded-xl border border-neutral-300 bg-white
								text-azento-700 placeholder:text-neutral-400
								focus:border-azento-500 focus:ring-2 focus:ring-azento-500/20
								transition-all duration-200"
							required
						/>
					</div>

					<!-- Email Field -->
					<div>
						<label for="email" class="block text-sm font-medium text-azento-600 mb-2">
							Correo electrónico <span class="text-red-500">*</span>
						</label>
						<input 
							type="email" 
							id="email" 
							name="email"
							placeholder="tu@email.com"
							maxlength="254"
							class="w-full px-4 py-3 rounded-xl border border-neutral-300 bg-white
								text-azento-700 placeholder:text-neutral-400
								focus:border-azento-500 focus:ring-2 focus:ring-azento-500/20
								transition-all duration-200"
							required
						/>
					</div>

					<!-- Phone Field -->
					<div>
						<label for="phone" class="block text-sm font-medium text-azento-600 mb-2">
							Teléfono
						</label>
						<input 
							type="tel" 
							id="phone" 
							name="phone"
							placeholder="+34 600 000 000"
							maxlength="30"
							class="w-full px-4 py-3 rounded-xl border border-neutral-300 bg-white
								text-azento-700 placeholder:text-neutral-400
								focus:border-azento-500 focus:ring-2 focus:ring-azento-500/20
								transition-all duration-200"
						/>
					</div>

					<!-- Service Select -->
					<div>
						<label for="service" class="block text-sm font-medium text-azento-600 mb-2">
							Servicio de interés
						</label>
						<select 
							id="service" 
							name="service"
							class="w-full px-4 py-3 rounded-xl border border-neutral-300 bg-white
								text-azento-700 focus:border-azento-500 focus:ring-2 focus:ring-azento-500/20
								transition-all duration-200"
						>
							<option value="">Selecciona un servicio</option>
							<option value="jardines-terrazas">Jardines y Terrazas</option>
							<option value="pergolas-celosias">Pérgolas y Celosías</option>
							<option value="fachadas-revestimientos">Fachadas y Revestimientos</option>
							<option value="reformas-interiores">Reformas Interiores</option>
							<option value="otro">Otro proyecto</option>
						</select>
					</div>

					<!-- Message Field -->
					<div>
						<label for="message" class="block text-sm font-medium text-azento-600 mb-2">
							Cuéntanos tu proyecto
						</label>
						<textarea 
							id="message" 
							name="message"
							rows="4"
							maxlength="2000"
							placeholder="Describe brevemente qué tienes en mente..."
							class="w-full px-4 py-3 rounded-xl border border-neutral-300 bg-white
								text-azento-700 placeholder:text-neutral-400 resize-none
								focus:border-azento-500 focus:ring-2 focus:ring-azento-500/20
								transition-all duration-200"
						></textarea>
					</div>

					<!-- Status Messages -->
					<div id="form-status" class="hidden">
						<!-- Success Message -->
						<div id="status-success" class="hidden p-4 rounded-xl bg-green-50 border border-green-200">
							<div class="flex items-center gap-3">
								<svg class="w-6 h-6 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
								</svg>
								<div>
									<p class="font-semibold text-green-800">¡Solicitud enviada!</p>
									<p class="text-sm text-green-600">Te contactaremos lo antes posible.</p>
								</div>
							</div>
						</div>
						
						<!-- Error Message -->
						<div id="status-error" class="hidden p-4 rounded-xl bg-red-50 border border-red-200">
							<div class="flex items-center gap-3">
								<svg class="w-6 h-6 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
								</svg>
								<div>
									<p class="font-semibold text-red-800">Error al enviar</p>
									<p id="error-message" class="text-sm text-red-600">Por favor, inténtalo de nuevo.</p>
								</div>
							</div>
						</div>
					</div>

					<!-- Submit Button -->
					<button 
						type="submit"
						id="submit-btn"
						class="w-full flex items-center justify-center gap-2 bg-azento-600 text-white 
							px-8 py-4 rounded-xl font-semibold shadow-lg shadow-azento-600/25
							hover:bg-azento-500 hover:shadow-xl hover:shadow-azento-600/30
							active:scale-[0.98] transition-all duration-300
							disabled:opacity-70 disabled:cursor-not-allowed disabled:hover:bg-azento-600"
					>
						<span id="btn-text">Enviar solicitud</span>
						<svg id="btn-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
								d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
						</svg>
						<!-- Loading spinner -->
						<svg id="btn-spinner" class="hidden w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
							<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
							<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
						</svg>
					</button>

					<!-- Privacy Note -->
					<p class="text-xs text-azento-400 text-center">
						Al enviar este formulario, aceptas nuestra 
						<a href="#" class="underline hover:text-azento-600">política de privacidad</a>.
					</p>
				</form>
			</div>
		</div>
	</div>
</section>

<script>
	const form = document.getElementById('quote-form') as HTMLFormElement;
	const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
	const btnText = document.getElementById('btn-text') as HTMLSpanElement;
	const btnIcon = document.getElementById('btn-icon') as HTMLElement;
	const btnSpinner = document.getElementById('btn-spinner') as HTMLElement;
	const formStatus = document.getElementById('form-status') as HTMLDivElement;
	const statusSuccess = document.getElementById('status-success') as HTMLDivElement;
	const statusError = document.getElementById('status-error') as HTMLDivElement;
	const errorMessage = document.getElementById('error-message') as HTMLParagraphElement;

	function setLoading(loading: boolean) {
		submitBtn.disabled = loading;
		btnText.textContent = loading ? 'Enviando...' : 'Enviar solicitud';
		btnIcon.classList.toggle('hidden', loading);
		btnSpinner.classList.toggle('hidden', !loading);
	}

	function showStatus(type: 'success' | 'error', message?: string) {
		formStatus.classList.remove('hidden');
		statusSuccess.classList.toggle('hidden', type !== 'success');
		statusError.classList.toggle('hidden', type !== 'error');
		
		if (type === 'error' && message) {
			errorMessage.textContent = message;
		}

		// Scroll al mensaje
		formStatus.scrollIntoView({ behavior: 'smooth', block: 'center' });
	}

	function hideStatus() {
		formStatus.classList.add('hidden');
		statusSuccess.classList.add('hidden');
		statusError.classList.add('hidden');
	}

	function resetForm() {
		form.reset();
	}

	form.addEventListener('submit', async (e) => {
		e.preventDefault();
		hideStatus();
		setLoading(true);

		// Recoger datos del formulario
		const formData = new FormData(form);
		const data = {
			name: formData.get('name') as string,
			email: formData.get('email') as string,
			phone: formData.get('phone') as string,
			service: formData.get('service') as string,
			message: formData.get('message') as string,
			honeypot: formData.get('website') as string, // Campo trampa
		};

		try {
			const response = await fetch('/api/quote', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify(data),
			});

			const result = await response.json();

			if (response.ok && result.ok) {
				showStatus('success');
				resetForm();
			} else {
				showStatus('error', result.error || 'Error al procesar la solicitud');
			}
		} catch (error) {
			console.error('Error:', error);
			showStatus('error', 'Error de conexión. Comprueba tu internet e inténtalo de nuevo.');
		} finally {
			setLoading(false);
		}
	});
</script>
